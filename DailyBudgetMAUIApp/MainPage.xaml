<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="DailyBudgetMAUIApp.MainPage"
             xmlns:xct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:handlers="clr-namespace:DailyBudgetMAUIApp.Handlers"
             xmlns:helpers="clr-namespace:DailyBudgetMAUIApp.Helpers"
             xmlns:the49="https://schemas.the49.com/dotnet/2023/maui"
             xmlns:converters="clr-namespace:DailyBudgetMAUIApp.Converters"
             Background="{StaticResource Primary}">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:IsBudgetSharedBudgetToBool x:Key="IsBudgetSharedBudgetToBool" />
            <converters:IsBudgetNotSharedBudgetToBool x:Key="IsBudgetNotSharedBudgetToBool" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <Shell.TitleView>
        <Grid ColumnDefinitions="*,40,40" ColumnSpacing="5">
            <Label Text="{Binding Title}" 
                   TextColor="White" 
                   VerticalOptions="Center"
                   FontSize="20" 
                   FontFamily="OpenSansSemibold" 
                   FontAttributes="Bold"
                   HorizontalOptions="Start"
                   Grid.Column="0"/>
            <Button TextColor="White"
                    BackgroundColor="{StaticResource Primary}"
                    Command="{Binding GoToAccountSettingsCommand}"
                    HorizontalOptions="End"
                    Grid.Column="1"
                    Padding="10,0,0,0">
                <Button.ImageSource>
                    <FontImageSource FontFamily="MaterialDesignIcons" Glyph="{x:Static helpers:MaterialDesignIconsFonts.Settings_suggest}" Size="30" />
                </Button.ImageSource>
            </Button>
            <Button TextColor="White"
                    BackgroundColor="{StaticResource Primary}"
                    Command="{Binding GoToAccountSettingsCommand}"
                    HorizontalOptions="End"
                    Grid.Column="2"
                    Padding="0,0,10,0">
                <Button.ImageSource>
                    <FontImageSource FontFamily="MaterialDesignIcons" Glyph="{x:Static helpers:MaterialDesignIconsFonts.Manage_accounts}" Size="30"/>
                </Button.ImageSource>
            </Button>
        </Grid>
    </Shell.TitleView>
    <RefreshView Command="{Binding RefreshPageCommand}" IsRefreshing="{Binding IsRefreshing}">
        <ScrollView>
            <VerticalStackLayout VerticalOptions="Start">
                <Border Style="{DynamicResource DashboardMainContent}" Padding="0">
                    <Grid ColumnDefinitions="Auto, *" RowDefinitions="Auto">
                        <Image Source="mainpagelogoprimary.png" Aspect="AspectFill" Grid.Row="0" Grid.Column="0" HeightRequest="60" Margin="20,0,0,0"/>
                        <VerticalStackLayout Grid.Row="0" Grid.Column="1" HorizontalOptions="End" Margin="0,10,35,10">
                            <Image Source="mainpagelogotext.png" Aspect="AspectFill"  HeightRequest="60"/>
                        </VerticalStackLayout>
                    </Grid>
                </Border>
                <Border Padding="0" Style="{DynamicResource DashboardMainContent}" IsVisible="{Binding IsBudgetCreated, Converter={StaticResource BoolConverter}}">
                    <Grid ColumnDefinitions="50,*,Auto" RowDefinitions="Auto" Padding="0" Margin="0">
                        <VerticalStackLayout HorizontalOptions="Start" VerticalOptions="Start" Grid.Column="0" Grid.Row="0" Margin="0,0,0,0">
                            <Image Source="mainpagelogoprimary.png" Aspect="AspectFill" WidthRequest="30" VerticalOptions="Start" HorizontalOptions="Start" Margin="10,10,0,0"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1" Grid.Row="0" Padding="0" HorizontalOptions="Start" VerticalOptions="Start" Margin="0,5,5,0">
                            <Label Margin="0" Padding="0,0,5,2" VerticalOptions="Start" Text="Complete Set up"  FontSize="Medium" TextColor="{DynamicResource Gray900}"/>
                            <Label Margin="0" Padding="0,0,5,5" VerticalOptions="End" Text="Click here to finalise your budget's details!" FontSize="Caption" TextColor="{DynamicResource Gray600}"/>
                        </VerticalStackLayout>
                        <Grid BackgroundColor="{DynamicResource Tertiary}" Grid.Column="2" Grid.Row="0" Padding="10,0,10,0" ColumnDefinitions="*" RowDefinitions="*">
                            <Image BackgroundColor="Transparent" Margin="0,5,0,5" VerticalOptions="Center" HorizontalOptions="Center">
                                <Image.Source>
                                    <FontImageSource FontFamily="MaterialDesignIcons" Glyph="{x:Static helpers:MaterialDesignIconsFonts.Chevron_right}" Size="40"  Color="{DynamicResource White}"/>
                                </Image.Source>
                            </Image>
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding NavigateCreateNewBudgetCommand}"/>
                            </Grid.GestureRecognizers>
                        </Grid>
                    </Grid>
                </Border>
                <Border Style="{DynamicResource DashboardMainContent}" Padding="0" IsVisible="{Binding DefaultBudget, Converter={StaticResource IsBudgetNotSharedBudgetToBool}}" >
                    <Grid ColumnDefinitions="50,*,Auto" RowDefinitions="Auto" Padding="0" Margin="0,0,0,0">
                        <Image Source="mainpagelogoprimary.png" Aspect="AspectFill" WidthRequest="30" VerticalOptions="Start" HorizontalOptions="Start" Margin="10,10,0,0"/>
                        <VerticalStackLayout Grid.Column="1" Grid.Row="0" HorizontalOptions="Start" VerticalOptions="Start" Margin="0,5,5,0">
                            <Label Margin="0" Padding="0,0,5,0" VerticalOptions="Start" Text="Share Your Budget!"  FontSize="Medium" TextColor="{DynamicResource Gray900}"/>
                            <Label Margin="0" Padding="0,0,5,5" VerticalOptions="End" Text="Click here to Share your budget with a family or friend!" FontSize="Caption" TextColor="{DynamicResource Gray600}"/>
                        </VerticalStackLayout>
                        <Grid BackgroundColor="{DynamicResource PrimaryLight}" Grid.Column="2" Grid.Row="0" Padding="10,0,10,0" ColumnDefinitions="*" RowDefinitions="*">
                            <Image BackgroundColor="Transparent" Margin="0,5,0,5" VerticalOptions="Center" HorizontalOptions="Center">
                                <Image.Source>
                                    <FontImageSource FontFamily="MaterialDesignIcons" Glyph="{x:Static helpers:MaterialDesignIconsFonts.Share}" Size="40"  Color="{DynamicResource White}"/>
                                </Image.Source>
                            </Image>
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer x:Name="ShareBudget" Tapped="ShareBudget_Tapped" />
                            </Grid.GestureRecognizers>
                        </Grid>
                    </Grid>
                </Border>
                <Border Style="{DynamicResource DashboardMainContent}">
                    <VerticalStackLayout>
                        <Button
                        x:Name="CounterBtn"
                        Text="Click me"
                        SemanticProperties.Hint="Counts the number of times you click"
                        HorizontalOptions="Center" />
                        <Button
                        x:Name="SignOut"
                        Command="{Binding SignOutCommand}"
                        Text="Sign Out"
                        SemanticProperties.Hint="Signs Out of Account"
                        HorizontalOptions="Center" />
                        <Label 
                            Text="{Binding DefaultBudgetID,StringFormat='The Deafault Budget ID is {0}'}"
                            Margin="0,100,0,0"
                            VerticalOptions="Center" 
                            HorizontalOptions="Center" 
                            TextColor="Black"/>
                        <Label TextColor="Black">
                            <MultiBinding StringFormat="'Testing how a multi binding works in a label with {0:c} and also {1:n} value'">
                                <Binding Path="DefaultBudgetID"/>
                                <Binding Path="DefaultBudgetID"/>
                            </MultiBinding>
                        </Label>
                        <Label Text="{Binding DefaultBudget.BankBalance, StringFormat='Your current Bank Balance is {0:c}'}"
                            VerticalOptions="Center" 
                            HorizontalOptions="Center" 
                            TextColor="Black"/>
                        <Label Text="{Binding DefaultBudget.BankBalance, StringFormat='Your current Bank Balance is {0:c}'}"
                            VerticalOptions="Center" 
                            HorizontalOptions="Center" 
                            TextColor="Black"/>
                        <Label Text="{Binding DefaultBudget.BudgetName, StringFormat='Your Budget Name is {0}'}"
                            VerticalOptions="Center" 
                            HorizontalOptions="Center"
                            TextColor="Black"/>
                        <Label x:Name="datetime"
                            VerticalOptions="Center" 
                            HorizontalOptions="Center"
                            TextColor="Black"/>
                    </VerticalStackLayout>
                </Border>
                <Border Style="{DynamicResource DashboardMainContent}">
                    <ListView ItemsSource="{Binding DefaultBudget.Bills}" RowHeight="130" Margin="10,0,20,0" SeparatorVisibility="None" x:Name="LVOutgoings" SelectionMode="None" HorizontalScrollBarVisibility="Never" VerticalScrollBarVisibility="Never">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <ViewCell>
                                    <VerticalStackLayout>
                                        <Label FontSize="Medium" Text="{Binding BillName}"></Label>
                                        <Label FontSize="Caption" Text="{Binding BillType}"></Label>
                                        <Label FontSize="Caption" Text="{Binding BillAmount, StringFormat='{0:c}'}"></Label>
                                        <Label FontSize="Caption" Text="{Binding BillCurrentBalance, StringFormat='{0:c}'}"></Label>
                                        <Label FontSize="Caption" Text="{Binding RegularBillValue, StringFormat='{0:c}'}"></Label>
                                    </VerticalStackLayout>
                                </ViewCell>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Border>
                <Border Style="{DynamicResource DashboardMainContent}">
                    <ListView ItemsSource="{Binding DefaultBudget.Savings}" RowHeight="180" Margin="10,0,20,0" SeparatorVisibility="None" x:Name="LVSavings" SelectionMode="None" HorizontalScrollBarVisibility="Never" VerticalScrollBarVisibility="Never">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <ViewCell>
                                    <VerticalStackLayout>
                                        <Label FontSize="Medium" Text="{Binding SavingsName}"/>
                                        <Label FontSize="Caption" Text="{Binding SavingsType}"/>
                                        <Label FontSize="Caption" Text="{Binding SavingGoal, StringFormat='{0:c}'}"/>
                                        <Label FontSize="Caption" Text="{Binding CurrentBalance, StringFormat='{0:c}'}"/>
                                        <Label FontSize="Caption" Text="{Binding RegularSavingValue, StringFormat='{0:c}'}"/>
                                        <Label FontSize="Caption" Text="{Binding PeriodSavingValue, StringFormat='{0:c}'}"/>
                                    </VerticalStackLayout>
                                </ViewCell>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Border>
                <Border Style="{DynamicResource DashboardMainContent}">
                    <ListView ItemsSource="{Binding DefaultBudget.IncomeEvents}" RowHeight="180" Margin="10,0,20,0" SeparatorVisibility="None" x:Name="LVIncome" SelectionMode="None" HorizontalScrollBarVisibility="Never" VerticalScrollBarVisibility="Never">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <ViewCell>
                                    <VerticalStackLayout>
                                        <Label FontSize="Medium" Text="{Binding IncomeName}"/>
                                        <Label FontSize="Caption" Text="{Binding IsInstantActive}"/>
                                        <Label FontSize="Caption" Text="{Binding IsRecurringIncome}"/>
                                        <Label FontSize="Caption" Text="{Binding IncomeAmount, StringFormat='{0:c}'}"/>
                                    </VerticalStackLayout>
                                </ViewCell>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Border>
            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>
